<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>map.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="extrasManager.html">extrasManager</a><ul class='methods'><li data-type='method'><a href="extrasManager.html#.hideSoftKeyboard">hideSoftKeyboard</a></li><li data-type='method'><a href="extrasManager.html#.queryData">queryData</a></li></ul></li><li><a href="initGlobals.html">initGlobals</a></li><li><a href="mapManager.html">mapManager</a><ul class='methods'><li data-type='method'><a href="mapManager.html#.boundsChangedListener">boundsChangedListener</a></li><li data-type='method'><a href="mapManager.html#.constructSearchBox">constructSearchBox</a></li><li data-type='method'><a href="mapManager.html#.getNewTileCoordinate">getNewTileCoordinate</a></li><li data-type='method'><a href="mapManager.html#.handleLocationError">handleLocationError</a></li><li data-type='method'><a href="mapManager.html#.initAutocomplete">initAutocomplete</a></li><li data-type='method'><a href="mapManager.html#.initMap">initMap</a></li><li data-type='method'><a href="mapManager.html#.mapIdleListener">mapIdleListener</a></li><li data-type='method'><a href="mapManager.html#.project">project</a></li><li data-type='method'><a href="mapManager.html#.searchBoxListener">searchBoxListener</a></li><li data-type='method'><a href="mapManager.html#.tilesLoadedListener">tilesLoadedListener</a></li><li data-type='method'><a href="mapManager.html#.userGeolocation">userGeolocation</a></li></ul></li><li><a href="pinManager.html">pinManager</a><ul class='methods'><li data-type='method'><a href="pinManager.html#.crimeMoreDetailsHelper">crimeMoreDetailsHelper</a></li><li data-type='method'><a href="pinManager.html#.handleMoreDetailsEvent">handleMoreDetailsEvent</a></li><li data-type='method'><a href="pinManager.html#.infowindowContent">infowindowContent</a></li><li data-type='method'><a href="pinManager.html#.legislatorMoreDetailsHelper">legislatorMoreDetailsHelper</a></li><li data-type='method'><a href="pinManager.html#.multiMoreDetailsHelper">multiMoreDetailsHelper</a></li><li data-type='method'><a href="pinManager.html#.setNewMarkers">setNewMarkers</a></li><li data-type='method'><a href="pinManager.html#.slowlyFadeIn">slowlyFadeIn</a></li><li data-type='method'><a href="pinManager.html#.slowlyFadeOut">slowlyFadeOut</a></li><li data-type='method'><a href="pinManager.html#.typeOfMarker">typeOfMarker</a></li><li data-type='method'><a href="pinManager.html#.wikiMoreDetailsHelper">wikiMoreDetailsHelper</a></li><li data-type='method'><a href="pinManager.html#.zoomIntoPin">zoomIntoPin</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#CRIME_PIN">CRIME_PIN</a></li><li><a href="global.html#crimePicture">crimePicture</a></li><li><a href="global.html#currentlyActiveInfowindowPin">currentlyActiveInfowindowPin</a></li><li><a href="global.html#dataLoaded">dataLoaded</a></li><li><a href="global.html#handleMoreDetailsEvent">handleMoreDetailsEvent</a></li><li><a href="global.html#infowindow">infowindow</a></li><li><a href="global.html#initAutoComplete">initAutoComplete</a></li><li><a href="global.html#INVALID_PIN">INVALID_PIN</a></li><li><a href="global.html#LEGISLATOR_PIN">LEGISLATOR_PIN</a></li><li><a href="global.html#map">map</a></li><li><a href="global.html#mapLoaded">mapLoaded</a></li><li><a href="global.html#markers">markers</a></li><li><a href="global.html#MULTI_PIN">MULTI_PIN</a></li><li><a href="global.html#oldTileCoordinate">oldTileCoordinate</a></li><li><a href="global.html#queryData">queryData</a></li><li><a href="global.html#sansadPicture">sansadPicture</a></li><li><a href="global.html#setNewMarkers">setNewMarkers</a></li><li><a href="global.html#TILE_SIZE">TILE_SIZE</a></li><li><a href="global.html#WIKI_PIN">WIKI_PIN</a></li><li><a href="global.html#wikiPicture">wikiPicture</a></li><li><a href="global.html#zoomIntoPin">zoomIntoPin</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">map.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Initializes and manages a Google Maps instance.
 * Declares helper functions to track the movement and loading of the map.
 * @author Tushar Agarwal
 */

/**
 * The &lt;code>mapManager&lt;/code> namespace encapsulates core map related functionality.
 * @namespace mapManager
 */
(function () {
    /**
     * Initializes a Google Maps instance centered (zoom level 12) at New Delhi, India.
     * Map type and Street View controls are hidden.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     * @returns {google.maps.Map}
     */
    function initMap() {
        return new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: {lat: 28.6139, lng: 77.2090},
            mapTypeControl: false,
            streetViewControl: false
        });
    }

    /**
     * Checks if the &lt;code>Geolocation Service&lt;/code> is available and
     * centers the map at the client's geographic location if it is.
     * The default zoom level is 12.
     * This function handles errors using &lt;code>handleLocationError()&lt;/code>.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     */
    function userGeolocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                // Using global variable here
                map.setCenter(pos);
                map.setZoom(12);
            }, function () {
                handleLocationError(true);
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false);
        }
    }

    /**
     * Triggers a "Toast"(&lt;code>Materialize.toast&lt;/code>) notification based
     * on the type of geolocation error (as inferred from &lt;code>browserHasGeolocation&lt;/code>)
     * and prints user-friendly error messages.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     * @param {boolean} browserHasGeolocation
     */
    function handleLocationError(browserHasGeolocation) {
        // Materialize.toast(message, displayLength, className, completeCallback);
        Materialize.toast(browserHasGeolocation ?
            'Is the Location Service enabled?' :
            'Your browser doesn\'t support geolocation.', 2000); // last number is the duration of the toast
    }

    /**
     * Calculates a "Point" from a latitude-longitude coordinate pair.
     * This is a helper function for &lt;code>getNewTileCoordinate()&lt;/code>.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     * @param {google.maps.LatLng} latLng
     * @returns {google.maps.Point}
     */
    function project(latLng) {
        var siny = Math.sin(latLng.lat() * Math.PI / 180);
        siny = Math.min(Math.max(siny, -0.9999), 0.9999);

        return new google.maps.Point(
            TILE_SIZE * (0.5 + latLng.lng() / 360),
            TILE_SIZE * (0.5 - Math.log((1 + siny) / (1 - siny)) / (4 * Math.PI)));
    }

    /**
     * Calculates the map's center's tile coordinates based on the &lt;code>TILE_SIZE&lt;/code>.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     * @returns {google.maps.Point}
     */
    function getNewTileCoordinate() {
        var currentBounds = map.getBounds();
        var currentCenterLatLng = currentBounds.getCenter();
        var scale = 1 &lt;&lt; map.getZoom();
        var worldCoordinate = project(currentCenterLatLng);
        return new google.maps.Point(
            Math.floor(worldCoordinate.x * scale / TILE_SIZE),
            Math.floor(worldCoordinate.y * scale / TILE_SIZE));
    }

    /**
     * This is a listener for the &lt;code>bounds_changed&lt;/code> event, so that the indeterminate loader can be triggered.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     */
    function boundsChangedListener() {
        var newTileCoordinate = getNewTileCoordinate();
        if (typeof oldTileCoordinate != 'undefined') {
            if ((Math.abs(newTileCoordinate.x - oldTileCoordinate.x) >= 2)
                || (Math.abs(newTileCoordinate.y - oldTileCoordinate.y) >= 2)) {
                mapLoaded = false;
                $('.activityIndicator').fadeIn(200);
            }
        }
    }

    /**
     * This is a listener for the &lt;code>tilesloaded&lt;/code> event, so that the indeterminate loader can be turned off.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     */
    function tilesLoadedListener() {
        oldTileCoordinate = getNewTileCoordinate();
        mapLoaded = true;
        if (mapLoaded &amp;&amp; dataLoaded) {
            $('.activityIndicator').fadeOut(200);
        }
    }

    /**
     * This is a listener for the map's &lt;code>idle&lt;/code> event, to load pins when the map
     * transitions to an idle state.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     */
    function mapIdleListener() {
        queryData();
    }

    /**
     * Listens for the event fired when the user selects a prediction and centers the map on that location.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     * @param {google.maps.places.SearchBox} searchBox
     */
    function searchBoxListener(searchBox) {
        var places = searchBox.getPlaces();

        if (places.length == 0) {
            return;
        }

        // For each place, get the name and location.
        var bounds = new google.maps.LatLngBounds();
        places.forEach(function (place) {
            if (place.geometry.viewport) {
                // Only geocodes have viewport.
                bounds.union(place.geometry.viewport);
            } else {
                bounds.extend(place.geometry.location);
            }
        });
        map.fitBounds(bounds);
    }

    /**
     * Creates the search box and links it to the UI element.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     */
    function constructSearchBox() {
        var input = document.getElementById('search-input');

        //noinspection JSCheckFunctionSignatures
        var searchBox = new google.maps.places.SearchBox(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function () {
            searchBox.setBounds(map.getBounds());
        });

        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function () {
            searchBoxListener(searchBox);
        });
    }

    //noinspection JSUndeclaredVariable
    /**
     * Initializes a Google Maps object, and adds listeners for &lt;code>bounds_changed&lt;/code> and
     * &lt;code>tilesloaded&lt;/code>, so that the indeterminate loader can be triggered and turned off.
     * The global variable corresponding to this function is declared in &lt;code>globals.js&lt;/code>.
     * Some code from https://developers.google.com/maps/documentation/javascript/reference#release-version
     * @memberof mapManager
     */
    initAutocomplete = function () {

        map = initMap();

        // Enable Listeners
        google.maps.event.addListener(map, 'bounds_changed', boundsChangedListener);
        google.maps.event.addListener(map, 'tilesloaded', tilesLoadedListener);
        google.maps.event.addListener(map, 'idle', mapIdleListener);

        // HTML5 geolocation
        userGeolocation();

        // Construct the search box
        constructSearchBox();
    };

    // Enables functionality for the "Go to my location" button.
    $('#myLocationButton').click(userGeolocation);

})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Apr 26 2016 01:37:08 GMT+0530 (IST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
